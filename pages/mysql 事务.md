tags:: mysql，事务

- 定义：
	- 事务是一组sql语句，作为一个工作单元以原子方式处理，只要有一条不成功，所有的都不执行
	- start transaction启动事务。
	- commit提交事务将修改数据持久保留
	- rollback撤销所有修改
	- ACID
		- 原子性 actomic
			- 一个事务是一个不可分割的工作单元，要么全部提交成功，要么全部回滚失败。
		- 一致性 consistency
			- 确保从一个一致性状态到下一个一致性状态。
		- 隔离性 isolation
			- 事务里做的修改，在最终提交之前，对其他事务不可见
		- 持久性durability
			- 一旦提交，事务所做的修改就被永久保存到数据库里。
- 隔离级别
	- 读未提交
		- 一个事务里可以看到其他事务未提交的修改。一般都不用，问题很多，效率也没高多少
		- 有脏读问题
	- 读已提交
		- 是大多数数据库默认的隔离级别，不是mysql的默认隔离级别
		- 事务里可以看到其他事务里提交了的修改
		- 导致不可重复读
	- 可重复读
		- 在提交前，都感知不到其他事务的修改
		- 但是如果要读取某个范围的数据，另外一个事务在这个范围里插入了新的记录，那还是能看到的
		- 有幻读问题
			- innodb和xtradb通过mvcc解决了幻读问题
		- 是mysql的默认隔离级别
	- 串行化
		- 一个一个的执行，完全没有并行发生的问题
		- 在读取每一行的时候都加锁，会导致大量超时和锁征用问题。一般不用
- 死锁
	- 多个事务相互持有和请求相同资源上的锁，产生了循环依赖
	- 解决
		- 各种死锁检测和锁超时机制
		- innodb，检测到循环依赖后会立即返回错误信息。将持有最少行级排他锁的事务回滚
		- 当超过锁等待超时的时间限制后立马直接终止查询
- 事务日志
	- 有助于提高事务效率
	- 存储引擎只需要更改内存里的数据副本。然后再把更改的记录写到事务日志里，日志会被持久到硬盘中。
	- 有个后台进程在某个时间更新硬盘中表
	- write-ahead logging
- mysql中的事务
	- 基于innodb引擎
	-
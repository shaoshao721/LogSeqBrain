tags:: 事务，分布式事务

- 事务及ACID特性
	- 事务：用户定义的一些数据库操作，要么全部执行要么都不执行
	- 事务为引用层服务，方便业务系统的开发，简化业务系统的开发，简化业务系统的编程模型出现的
- 特性：
	- 原子性：要么全部提交成功，要么全部失败回滚，不能执行其中一部分。
	- 一致性：数据库的一致性及业务上的一致性。只能从一种有效状态变成另外一种有效状态。
	- 隔离性：一个事务所做的修改，在最终提交之前，对其他的事务都不可见。只有可串行化符合
		- 四种隔离级别
			- 读未提交 脏读
			- 读已提交 不可重复读
			- 可重复读 幻读
			- 串行化
		- 持久性：事务被提交了之后，他的改变是永久的。
- 分布式事务
	- 分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的[分布式系统]
- XA两阶段提交
	- 作为资源管理器及事务协调器的标准接口
		- XA
			- open,close 资源管理器的开启和关闭
			- start，end 开始结束一个本地事务
			- prepare，commit，rollback 事务协调器的预提交，提交和回滚
			- recover 回滚一个已经预提交的事务
		- AX
			- reg，unreg 资源管理器的注册。动态注册了之后，可以对事务iD进行操作
	- 用来管理分布式事务，保证数据的强一致性，解决很多临时性系统故障（进程，网络节点，通信）
	- 两段式提交
		- 第一阶段
			- 事务协调器通知参加该事务的所有资源管理器开始准备事务
			- 资源管理器在接收到消息器后开始准备（写事务日志并执行事务，但是不提交。
			- 提交就绪消息给事务协调器，这时候事务的大部分事情已经做完了
		- 第二阶段
			- 事务协调器收到各个资源管理器回复的消息后，基于投票结果进行决策，来判断提交或者取消。
			- 如果有一个失败，会回滚。否则提交
			- 各个资源管理器收到二阶段提交或回滚命令之后，执行并将结果返回给事务协调器。
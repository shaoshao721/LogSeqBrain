tags:: 消息队列，缓存策略，磁盘IO

- 为啥用磁盘
	- 持久化存储，即使断电，数据也还存在着。
	- 便宜，低成本能存储海量消息
	- 缺点
		- 读写速度慢，SSD 每秒钟读写几千次。如果每次请求要读写3-5次，那每秒才能处理1000次左右请求
		- 内存的随机读写速度是磁盘的10万倍。内存作为缓存加速应用访问速度。
- 使用缓存最佳实践
	- 选择只读缓存还是读写缓存
		- 区别：更新数据的时候，是否经过缓存。
		- pageCache就是读写缓存。写文件的时候，数据先写到缓存。写完了就结束，操作系统异步的把数据更新到磁盘文件里。读文件的时候，先从pageCache读，找不到的话产生缺页中断，将文件读取到pageCache里，再返回给应用程序。
			- 操作系统可以保证，异常退出的时候，还是能把pageCache的内容同步到磁盘，但是要是断电了，就不行了
			- 不太可靠，牺牲数据一致性换取性能
			- 实现复杂，操作系统要记录数据又哪些变化，在另外一个线程，要把变化的数据更新到磁盘里。在提供并发读写的同时来异步更新数据，这个过程中要保证数据的一致性，并且有非 常好的性能，实现这些真不是一件容易的事儿。
			- 不推荐用读写缓存
				- 那为啥kafka用pageCache提升性能呢?
					- 消息队列读写比例大概是1：1.只读缓存提升效果不大
					- 不止靠磁盘保证数据可靠性，更依赖不同节点上的多副本，不会丢消息
					- pageCache不是kafka实现的，是操作系统实现的，不涉及复杂问题
			- 大部分消息队列也用读写缓存加速消息写入，只是实现方式不一样
	- 构建只读缓存要考虑的问题